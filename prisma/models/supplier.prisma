/// ===============================
///  SUPPLIER STRUCTURE
///  - Fornecedor pertence a uma loja.
///  - Pode ter vários responsáveis (SupplierResponsible).
///  - Suporte a mídia, auditoria e soft delete.
/// ===============================

model Supplier {
  id              String     @id @default(cuid())
  
  // Identificação básica
  corporateName   String     // Razão social
  tradeName       String?    // Nome fantasia
  cnpj            String
  ie              String?    // Inscrição estadual opcional
  email           String?
  phone           String?
  website         String?
  description     String?    // Observação interna

  // Localização
  cep             String?
  city            String?
  state           String?
  address         String?
  complement      String?

  // Relacionamento com a loja
  storeId         String
  store           Store       @relation(fields: [storeId], references: [id], onDelete: Cascade)

  // Status e auditoria
  status          Boolean     @default(true)
  deletedAt       DateTime?   // soft delete
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  // Relacionamentos
  products        Product[]
  movements       Movement[]
  responsibles    SupplierResponsible[]
  media           SupplierMedia[]

  // Configurações / metadados (extensível)
  tags            Json?       // Ex: ["distribuidor", "nacional"]
  metadata        Json?       // Ex: { "frete": "próprio", "tempoEntrega": "48h" }

  @@unique([cnpj, storeId])
  @@index([storeId])
  @@index([status])
  @@index([deletedAt])
  @@map("suppliers")
}

model SupplierResponsible {
  id           String    @id @default(cuid())
  supplierId   String
  supplier     Supplier  @relation(fields: [supplierId], references: [id], onDelete: Cascade)

  name         String
  role         String?   // cargo ex: "Vendas", "Financeiro", "Logística"
  phone        String?
  email        String?
  cpf          String?
  whatsapp     Boolean   @default(false) // se esse contato é via WhatsApp
  mainContact  Boolean   @default(false) // define se é o contato principal
  notes        String?   // observações internas
  status       Boolean   @default(true)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  deletedAt    DateTime? // soft delete

  @@index([supplierId])
  @@index([status])
  @@index([mainContact])
  @@map("supplier_responsibles")
}
